---
title: ğŸ«¡Dockerè¿è¡Œä¸€ä¸ªå®¹å™¨å¹¶å›ºå®šIP
date: 2023-8-07
tags: 
  - Docker
---

ä¸€äº›ç‰¹æ®Šéƒ¨ç½²åœºæ™¯ä¸‹ï¼Œéœ€è¦æŒ‡å®šæŸä¸ªå®¹å™¨ipä»¥ä¾¿äºè®¿é—®ã€‚å¯ä»¥ä½¿ç”¨Dockerçš„ç½‘ç»œæ¨¡å¼æ¥é—´æ¥åœ°æ§åˆ¶å®¹å™¨çš„IPåœ°å€ï¼Œæ‰€ä»¥è¿™è¾¹è®°å½•ä¸€ä¸‹åˆ†åˆ«åœ¨å•ç‹¬dockerä¸docker-composeé…ç½®ç¤ºä¾‹ï¼â˜˜

## docker

### 1.è‡ªå®šä¹‰ä¸€ä¸ªåä¸ºmy-docker-netç½‘ç»œ

```sh
docker network create --subnet=172.0.0.0/24 my-docker-net
```

### 2.æŒ‡å®šå®¹å™¨ç½‘ç»œå¹¶è®¾ç½®å›ºå®šip

```sh
docker run -d   --net=my-docker-net --ip=172.0.0.3 --name=[å®¹å™¨åå­—] [é•œåƒåå­—]
```

`--net` æŒ‡å®šç½‘ç»œ  
`--ip`  æŒ‡å®šip  

é€šè¿‡IP`172.0.0.3`è®¿é—®è¯¥å®¹å™¨äº†ã€‚

## docker-compose

åœ¨docker-compose.ymlæ–‡ä»¶ä¸­`networks`èŠ‚ç‚¹è¿›è¡Œé…ç½®

### 1.subnet è¿›è¡Œé…ç½®ç½‘æ®µ

```yml
networks:
  default:
    driver: bridge
    ipam:
      driver: default
      # è§£é™¤ä¸‹é¢çš„æ³¨é‡Šå¯ä»¥è®¾ç½®ç½‘æ®µï¼Œç”¨äºnginxç­‰å®¹å™¨å›ºå®šå®¹å™¨IP
      config:
        - subnet: 172.0.0.0/24
```

### 2.å¯¹åº”serviceä¸‹`networks`èŠ‚ç‚¹è¿›è¡Œé…ç½®å›ºå®šip

```yml
version: "3"
    services:
        nginx:
            networks:
                default:
                    ipv4_address: 172.0.0.3
```

ä»¥ä¸Šå‘½ä»¤å¯¹composeçš„ç½‘ç»œé…ç½®ä¸€ä¸ª172.0.0.0/24ç½‘æ®µï¼Œç„¶åæŒ‡å®šå…¶ä¸­`nginx`æŒ‡å®šipä¸º`172.0.0.3`

<!--more-->
## è¡¥å……çŸ¥è¯†

172.0.0.0/24 æ˜¯ä¸€ä¸ª CIDRï¼ˆClassless Inter-Domain Routingï¼‰è¡¨ç¤ºæ³•ï¼Œå®ƒä½¿ç”¨ç½‘ç»œåœ°å€å’Œæ©ç é•¿åº¦æ¥è¡¨ç¤ºä¸€ä¸ª IP åœ°å€èŒƒå›´ã€‚255.255.255.0 æ˜¯å¯¹åº”çš„å­ç½‘æ©ç ï¼Œä¹Ÿç§°ä¸ºç½‘ç»œæ©ç ã€‚åŒ…å«äº†ä» 172.0.0.0 åˆ° 172.0.0.255 çš„æ‰€æœ‰ IP åœ°å€ã€‚

åœ¨ CIDRï¼ˆClassless Inter-Domain Routingï¼‰è¡¨ç¤ºæ³•ä¸­ï¼Œæ–œçº¿åçš„æ•°å­—è¡¨ç¤ºæ©ç é•¿åº¦ï¼Œç”¨äºæŒ‡ç¤ºç½‘ç»œåœ°å€ä¸­çš„è¿ç»­å‰ç¼€ä½æ•°ã€‚

å…·ä½“æ¥è¯´ï¼Œæ©ç é•¿åº¦æ˜¯æŒ‡ç½‘ç»œåœ°å€ä¸­å·¦è¾¹çš„è¿ç»­ä½æ•°ï¼Œç”¨äºè¡¨ç¤ºç½‘ç»œéƒ¨åˆ†ã€‚å‰©ä½™çš„ä½æ•°åˆ™ç”¨äºè¡¨ç¤ºä¸»æœºéƒ¨åˆ†ã€‚

å¯¹äº IPv4 åœ°å€ï¼Œæ©ç é•¿åº¦çš„æœ‰æ•ˆèŒƒå›´æ˜¯ä» 0 åˆ° 32ã€‚è¾ƒå°çš„æ©ç é•¿åº¦è¡¨ç¤ºæ›´å¤§çš„ç½‘ç»œèŒƒå›´ï¼Œè€Œè¾ƒå¤§çš„æ©ç é•¿åº¦è¡¨ç¤ºæ›´å°çš„ç½‘ç»œèŒƒå›´ã€‚

ä¾‹å¦‚ï¼š

1. /8 è¡¨ç¤ºç½‘ç»œåœ°å€ä¸­çš„å‰ 8 ä½ç”¨äºç½‘ç»œéƒ¨åˆ†ï¼Œå 24 ä½ç”¨äºä¸»æœºéƒ¨åˆ†ã€‚
2. /16 è¡¨ç¤ºç½‘ç»œåœ°å€ä¸­çš„å‰ 16 ä½ç”¨äºç½‘ç»œéƒ¨åˆ†ï¼Œå 16 ä½ç”¨äºä¸»æœºéƒ¨åˆ†ã€‚
3. /24 è¡¨ç¤ºç½‘ç»œåœ°å€ä¸­çš„å‰ 24 ä½ç”¨äºç½‘ç»œéƒ¨åˆ†ï¼Œå 8 ä½ç”¨äºä¸»æœºéƒ¨åˆ†ã€‚

> å› æ­¤`/8` ä¸­çš„æ•°å­— 8 è¡¨ç¤ºç½‘ç»œåœ°å€ä¸­çš„å‰ 8 ä½ç”¨äºç½‘ç»œéƒ¨åˆ†ï¼Œå‰©ä¸‹çš„ä½ç”¨äºä¸»æœºéƒ¨åˆ†ã€‚è¿™æ„å‘³ç€ 172.0.0.0/8 è¡¨ç¤ºä¸€ä¸ªéå¸¸å¤§çš„ç½‘ç»œèŒƒå›´ï¼Œå…¶ä¸­ 172.0.0.0 åˆ° 172.255.255.255 éƒ½å±äºåŒä¸€ä¸ªç½‘ç»œã€‚
